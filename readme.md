# 目前存在的问题

### 消息的有序性怎么保证？

一般分为两种，如果是 p2p 形式，以用户发送方的本地时间作为绝对时序（比如本机的时间戳），
是可以保证消息的有序性的，即使因为网络原因导致乱序的情况发生，但因为这个乱序的时间对用户
来说体感不强，在接收端按照这个时序进行展示，用户是没有多少感知的，或者也可以在接收端做一
乱序时间差的基准值，例如 100ms 是一般乱序时间差的基准值，那么在接收端接收到消息后延迟这
个基准值后进行 UI 展示可能体验更好。

如果是 p2g 形式，也可以通过服务端给消息做一个 seq 序列号，表示消息的有序性，但是缺点也
很明显，序列号的生成可能是这个 im 的性能瓶颈。但其实群消息其实也不用保证全局消息序列有序
，而只要保证一个群内的消息有序即可，这样的话，「消息 id 序列化」就是一个很好的思路。我们
只要保证消息 id 是趋势递增的，那么在群内消息根据消息 id 进行排序展示即可。所谓的趋势递
增即 id 可以不严格递增（中间可以跳过），但是必须是趋势递增。

> 当然 p2p 模式下也可以基于消息 id 进行排序展示

### 目前 im-data-core 模块每次收到消息队列消息进行消费时 100% 会重新消费一次（待排查）

参考文章：
- http://www.52im.net/thread-3189-1-1.html
- http://www.52im.net/forum.php?mod=viewthread&tid=3445&highlight=%D3%D0%D0%F2
- 